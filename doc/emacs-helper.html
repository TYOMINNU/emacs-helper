<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="zh-CN" xml:lang="zh-CN">
<head>
<title>emacs-helper配置说明</title>
<!-- 2014-12-01 一 13:56 -->
<meta  http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta  name="generator" content="Org-mode" />
<meta  name="author" content="冯书" />
<link rel="stylesheet" type="text/css" href="./style/worg.css" />
<link rel="alternate stylesheet" type="text/css" href="./style/zenburn-emacs.css" />
<link rel="alternate stylesheet" type="text/css" href="./style/worg-classic.css" />
</head>
<body>
<div id="content">
<h1 class="title">emacs-helper配置说明</h1>
<div id="table-of-contents">
<h2>&#30446;&#24405;</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#sec-1">1. eh-gnus.el</a>
<ul>
<li><a href="#sec-1-1">1.1. 显摆gnus截图</a>
<ul>
<li><a href="#sec-1-1-1">1.1.1. gnus组名称列表（group buffer）</a></li>
<li><a href="#sec-1-1-2">1.1.2. gnus新闻标题列表（summary buffer）</a></li>
<li><a href="#sec-1-1-3">1.1.3. gnus新闻标题+正文（summary buffer + article buffer）</a></li>
</ul>
</li>
<li><a href="#sec-1-2">1.2. 解释配置原理</a></li>
<li><a href="#sec-1-3">1.3. 设定基本信息</a>
<ul>
<li><a href="#sec-1-3-1">1.3.1. 邮箱访问设置</a></li>
<li><a href="#sec-1-3-2">1.3.2. 本机设置</a></li>
<li><a href="#sec-1-3-3">1.3.3. dovecot设置</a></li>
</ul>
</li>
<li><a href="#sec-1-4">1.4. 安装辅助程序</a></li>
<li><a href="#sec-1-5">1.5. 配置辅助程序</a>
<ul>
<li><a href="#sec-1-5-1">1.5.1. gnupg-agent</a></li>
<li><a href="#sec-1-5-2">1.5.2. 邮件发送程序</a>
<ul>
<li><a href="#sec-1-5-2-1">1.5.2.1. msmtp</a></li>
</ul>
</li>
<li><a href="#sec-1-5-3">1.5.3. Imap服务器程序</a>
<ul>
<li><a href="#sec-1-5-3-1">1.5.3.1. dovecot</a></li>
</ul>
</li>
<li><a href="#sec-1-5-4">1.5.4. 邮件下载程序</a>
<ul>
<li><a href="#sec-1-5-4-1">1.5.4.1. offlineimap</a></li>
<li><a href="#sec-1-5-4-2">1.5.4.2. isync</a></li>
<li><a href="#sec-1-5-4-3">1.5.4.3. fdm</a></li>
</ul>
</li>
<li><a href="#sec-1-5-5">1.5.5. 新闻组下载程序</a>
<ul>
<li><a href="#sec-1-5-5-1">1.5.5.1. leafnode</a></li>
</ul>
</li>
<li><a href="#sec-1-5-6">1.5.6. rss下载程序</a>
<ul>
<li><a href="#sec-1-5-6-1">1.5.6.1. rss2email</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#sec-1-6">1.6. 定时下载rss和同步邮件</a></li>
<li><a href="#sec-1-7">1.7. gnus配置</a></li>
</ul>
</li>
<li><a href="#sec-2">2. eh-translate.el</a>
<ul>
<li><a href="#sec-2-1">2.1. 截图显摆</a>
<ul>
<li><a href="#sec-2-1-1">2.1.1. sdcv字典</a></li>
<li><a href="#sec-2-1-2">2.1.2. google翻译</a></li>
<li><a href="#sec-2-1-3">2.1.3. bing翻译</a></li>
</ul>
</li>
<li><a href="#sec-2-2">2.2. 命令介绍</a>
<ul>
<li><a href="#sec-2-2-1">2.2.1. eh-bing-translate-at-point</a></li>
<li><a href="#sec-2-2-2">2.2.2. eh-sdcv-translate-at-point</a></li>
<li><a href="#sec-2-2-3">2.2.3. google-translate-at-point</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#sec-3">3. eh-fonts.el</a>
<ul>
<li><a href="#sec-3-1">3.1. 安装</a></li>
<li><a href="#sec-3-2">3.2. 设置</a></li>
<li><a href="#sec-3-3">3.3. 使用</a></li>
</ul>
</li>
<li><a href="#sec-4">4. eh-complete.el</a></li>
</ul>
</div>
</div>

<div id="outline-container-sec-1" class="outline-2">
<h2 id="sec-1"><span class="section-number-2">1</span> eh-gnus.el</h2>
<div class="outline-text-2" id="text-1">
</div><div id="outline-container-sec-1-1" class="outline-3">
<h3 id="sec-1-1"><span class="section-number-3">1.1</span> 显摆gnus截图</h3>
<div class="outline-text-3" id="text-1-1">
</div><div id="outline-container-sec-1-1-1" class="outline-4">
<h4 id="sec-1-1-1"><span class="section-number-4">1.1.1</span> gnus组名称列表（group buffer）</h4>
<div class="outline-text-4" id="text-1-1-1">

<div class="figure">
<p><img src="./images/gnus-group.png" alt="gnus-group.png" />
</p>
</div>
</div>
</div>

<div id="outline-container-sec-1-1-2" class="outline-4">
<h4 id="sec-1-1-2"><span class="section-number-4">1.1.2</span> gnus新闻标题列表（summary buffer）</h4>
<div class="outline-text-4" id="text-1-1-2">

<div class="figure">
<p><img src="./images/gnus-summary1.png" alt="gnus-summary1.png" />
</p>
</div>


<div class="figure">
<p><img src="./images/gnus-summary2.png" alt="gnus-summary2.png" />
</p>
</div>
</div>
</div>

<div id="outline-container-sec-1-1-3" class="outline-4">
<h4 id="sec-1-1-3"><span class="section-number-4">1.1.3</span> gnus新闻标题+正文（summary buffer + article buffer）</h4>
<div class="outline-text-4" id="text-1-1-3">

<div class="figure">
<p><img src="./images/gnus-summary+article.png" alt="gnus-summary+article.png" />
</p>
</div>
</div>
</div>
</div>

<div id="outline-container-sec-1-2" class="outline-3">
<h3 id="sec-1-2"><span class="section-number-3">1.2</span> 解释配置原理</h3>
<div class="outline-text-3" id="text-1-2">

<div class="figure">
<p><img src="images/gnus配置基本原理.png" alt="gnus配置基本原理.png" />
</p>
</div>
</div>
</div>
<div id="outline-container-sec-1-3" class="outline-3">
<h3 id="sec-1-3"><span class="section-number-3">1.3</span> 设定基本信息</h3>
<div class="outline-text-3" id="text-1-3">
</div><div id="outline-container-sec-1-3-1" class="outline-4">
<h4 id="sec-1-3-1"><span class="section-number-4">1.3.1</span> 邮箱访问设置</h4>
<div class="outline-text-4" id="text-1-3-1">
<ol class="org-ol">
<li>邮箱地址: <code>YOUREMAIL@gmail.com</code>
</li>
<li>邮箱密码: <code>YOURPASSWORD</code>
</li>
<li>smtp服务器地址: <code>smtp.gmail.com</code>
</li>
<li>smtp服务器端口: <code>587</code>
</li>
<li>imap服务器地址: <code>imap.gmail.com</code>
</li>
<li>imap服务器端口: <code>993</code>
</li>
</ol>
</div>
</div>
<div id="outline-container-sec-1-3-2" class="outline-4">
<h4 id="sec-1-3-2"><span class="section-number-4">1.3.2</span> 本机设置</h4>
<div class="outline-text-4" id="text-1-3-2">
<ol class="org-ol">
<li>本机登陆用户: <code>feng</code>
</li>
<li>HOME目录: <code>/home/feng</code>
</li>
</ol>
</div>
</div>
<div id="outline-container-sec-1-3-3" class="outline-4">
<h4 id="sec-1-3-3"><span class="section-number-4">1.3.3</span> dovecot设置</h4>
<div class="outline-text-4" id="text-1-3-3">
<ol class="org-ol">
<li>email保存目录:  <code>/home/feng/maildir</code>
</li>
<li>dovecot常规邮件保存账户: <code>myemail</code>
</li>
<li>dovecot常规邮件保存账户密码: <code>myemail-password</code>
</li>
<li>dovecot rss订阅邮件保存账户: <code>myrss</code>
</li>
<li>dovecot rss订阅邮件保存账户: <code>myrss-password</code>
</li>
</ol>
</div>
</div>
</div>

<div id="outline-container-sec-1-4" class="outline-3">
<h3 id="sec-1-4"><span class="section-number-3">1.4</span> 安装辅助程序</h3>
<div class="outline-text-3" id="text-1-4">
<p>
安装msmtp, offlineimap, isync, leafnode, dovecot and gnupg-agent
</p>
<div class="org-src-container">

<pre class="src src-shell">sudo apt-get install msmtp msmtp-gnome offlineimap isync leafnode dovecot-core dovecot-imapd gnupg-agent
</pre>
</div>

<p>
Debian 7软件库中的html2test和feedparser版本太低，只能使用其他方式安装rss2email
</p>

<p>
首先： 安装easy_install和easy_install3。
</p>

<div class="org-src-container">

<pre class="src src-shell">sudo apt-get install python3-setuptools
</pre>
</div>

<p>
然后： 使用easy_install3安装rss2email。注意： rss2email使用python3。
</p>

<div class="org-src-container">

<pre class="src src-shell">sudo easy_install3 html2text
sudo easy_install3 feedparser
sudo easy_install3 rss2email
sudo easy_install3 pinyin
</pre>
</div>

<p>
rss2email使用base64编码中文，procmail处理起来非常费事，我这里使用一个拼音后处理插件，在rss转化为邮件的过程中，自动添加两个邮件field：X-Pinyin-From 和 X-Pinyin-Subject，用来保存Subject和From中文字符串的拼音，这样就可以在procmailrc中使用拼音来分类rss。
</p>

<p>
rss2email后处理插件是标准的python包，我们使用 <code>rss2email_post_hooks</code> 作为其名称。
首先创建目录： <code>rss2email_post_hooks</code>
</p>

<p>
然后在目录下添加一个空白文件：__init__.py，表明这个目录是一个python包。
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #8B8989; font-style: italic;"># </span><span style="color: #8B8989; font-style: italic;">This is a blank file.</span>
</pre>
</div>

<p>
最后在目录中添加pinyin_header.py文件。
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #8B8989; font-style: italic;"># </span><span style="color: #8B8989; font-style: italic;">This file is a post_process of rss2email</span>
<span style="color: #8B8989; font-style: italic;">#</span>
<span style="color: #8B8989; font-style: italic;"># </span><span style="color: #8B8989; font-style: italic;">rss2email will encode UTF-8 string with base64 before send mail,</span>
<span style="color: #8B8989; font-style: italic;"># </span><span style="color: #8B8989; font-style: italic;">which is difficult filted by procmail. This post_process will</span>
<span style="color: #8B8989; font-style: italic;"># </span><span style="color: #8B8989; font-style: italic;">add addition headers: X-Pinyin-From header and X-Pinyin-Subject,</span>
<span style="color: #8B8989; font-style: italic;"># </span><span style="color: #8B8989; font-style: italic;">They will store pinyin strings converted From header and Subject header</span>
<span style="color: #8B8989; font-style: italic;"># </span><span style="color: #8B8989; font-style: italic;">before send mail.</span>
<span style="color: #8B8989; font-style: italic;">#</span>
<span style="color: #8B8989; font-style: italic;"># </span><span style="color: #8B8989; font-style: italic;">Use:</span>
<span style="color: #8B8989; font-style: italic;"># </span><span style="color: #8B8989; font-style: italic;">add the below line to your rss2email configure:</span>
<span style="color: #8B8989; font-style: italic;">#</span>
<span style="color: #8B8989; font-style: italic;">#       </span><span style="color: #8B8989; font-style: italic;">post-process = rss2email_post_hooks.pinyin_header add_pinyin_header</span>
<span style="color: #8B8989; font-style: italic;">#</span>

<span style="color: #FBDE2D;">import</span> rss2email.email
<span style="color: #FBDE2D;">import</span> pinyin

<span style="color: #FBDE2D;">def</span> <span style="color: #ff1493;">remove_non_ascii</span>(string):
    <span style="color: #61CE3C;">"""remove no ascii char in string"""</span>
    <span style="color: #FBDE2D;">return</span> <span style="color: #61CE3C;">""</span>.join([i <span style="color: #FBDE2D;">for</span> i <span style="color: #FBDE2D;">in</span> string <span style="color: #FBDE2D;">if</span> <span style="color: #FF6400;">ord</span>(i)&lt;128])

<span style="color: #FBDE2D;">def</span> <span style="color: #ff1493;">add_pinyin_header</span>(message, **kwargs):
    <span style="color: #D8FA3C;">header_subject</span> = rss2email.email._decode_header(message[<span style="color: #61CE3C;">'Subject'</span>])
    <span style="color: #D8FA3C;">header_from</span> = rss2email.email._decode_header(message[<span style="color: #61CE3C;">'From'</span>])
    <span style="color: #D8FA3C;">message</span>[<span style="color: #61CE3C;">'X-Pinyin-Subject'</span>] = remove_non_ascii(pinyin.get(header_subject))
    <span style="color: #D8FA3C;">message</span>[<span style="color: #61CE3C;">'X-Pinyin-From'</span>] = remove_non_ascii(pinyin.get(header_from))
    <span style="color: #FBDE2D;">return</span> message
</pre>
</div>

<p>
将rss2email_post_hooks所在的目录添加到PYTHONPATH（语法与shell里面的PATH一样），比如， 在~/.bashrc文件中写入下面一行语句。
</p>

<div class="org-src-container">

<pre class="src src-org">export PYTHONPATH=$PYTHONPATH:/home/feng/.config/eh-gnus/configs
</pre>
</div>

<p>
也可以在编写shell脚本的时候，插入赋值语句：
</p>
<div class="org-src-container">

<pre class="src src-org" id="rss2email-setup-python-path">PYTHONPATH=$PYTHONPATH:/home/feng/.config/eh-gnus/configs
</pre>
</div>

<p>
在rss2email配置文件中写入一行配置：
</p>
<div class="org-src-container">

<pre class="src src-org" id="rss2email-setup-post-process">post-process = rss2email_post_hooks.pinyin_header add_pinyin_header
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-1-5" class="outline-3">
<h3 id="sec-1-5"><span class="section-number-3">1.5</span> 配置辅助程序</h3>
<div class="outline-text-3" id="text-1-5">
</div><div id="outline-container-sec-1-5-1" class="outline-4">
<h4 id="sec-1-5-1"><span class="section-number-4">1.5.1</span> gnupg-agent</h4>
<div class="outline-text-4" id="text-1-5-1">
<p>
~/.gnupg/gpg-agent.conf
</p>
<div class="org-src-container">

<pre class="src src-org">### PIN entry Program
<span style="color: #8B8989; font-style: italic;"># pinentry-program /usr/bin/pinentry-curses</span>
<span style="color: #8B8989; font-style: italic;"># pinentry-program /usr/bin/pinentry-qt4</span>
<span style="color: #8B8989; font-style: italic;"># pinentry-program /usr/bin/pinentry-kwallet</span>
pinentry-program /usr/bin/pinentry-gtk-2

### Keyboard control
no-grab

### Cache timeout: 3 hours
default-cache-ttl 10800
<span style="color: #8B8989; font-style: italic;"># default-cache-ttl-ssh 10800</span>
</pre>
</div>

<p>
~/.gnupg/gpg.conf
</p>
<div class="org-src-container">

<pre class="src src-org">... &#65288;&#24573;&#30053;&#65289;

use-agent

... &#65288;&#24573;&#30053;&#65289;
</pre>
</div>

<p>
Debian系统中，gnupg-agent软件包自带启动脚本，只要gnupg配置文件（~/.gnupg/gpg.conf或~/.gnupg/options）中，use-agent选项激活，gnupg-agent就会随着X自动启动，启动脚本为：
</p>
<div class="org-src-container">

<pre class="src src-org">/etc/X11/Xsession.d/90gpg-agent
</pre>
</div>

<p>
如果需要手动启动gpg-agent,可以使用下面的命令:
</p>
<div class="org-src-container">

<pre class="src src-org">eval "$(gpg-agent --daemon)"
</pre>
</div>
<p>
或者
</p>
<div class="org-src-container">

<pre class="src src-org">bash /etc/X11/Xsession.d/90gpg-agent
</pre>
</div>

<p>
关闭 gnupg-agent
</p>
<div class="org-src-container">

<pre class="src src-shell"><span style="color: #FBDE2D;">if</span> [ -n <span style="color: #61CE3C;">"${GPG_AGENT_INFO}"</span> ]; <span style="color: #FBDE2D;">then</span>
  <span style="color: #FF6400;">kill</span> $(<span style="color: #fa8072;">echo</span> ${<span style="color: #D8FA3C;">GPG_AGENT_INFO</span>} | cut -d<span style="color: #61CE3C;">':'</span> -f 2) &gt;/dev/null 2&gt;&amp;1
<span style="color: #FBDE2D;">fi</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-sec-1-5-2" class="outline-4">
<h4 id="sec-1-5-2"><span class="section-number-4">1.5.2</span> 邮件发送程序</h4>
<div class="outline-text-4" id="text-1-5-2">
</div><div id="outline-container-sec-1-5-2-1" class="outline-5">
<h5 id="sec-1-5-2-1"><span class="section-number-5">1.5.2.1</span> msmtp</h5>
<div class="outline-text-5" id="text-1-5-2-1">
<p>
msmpt配置文件~/.msmptrc的内容如下：
</p>
<div class="org-src-container">

<pre class="src src-org" id="msmtprc">defaults
tls on
tls_certcheck off
tls_starttls on

account default
host smtp.gmail.com
domain smtp.gmail.com
tls on
tls_certcheck off
tls_starttls on
auth on
user YOUREMAIL@gmail.com
from YOUREMAIL@gmail.com
<span id="coderef-password" class="coderef-off">password YOURPASSWORD</span>
port 587
logfile /home/feng/.config/eh-gnus/configs/log/msmtp.log
</pre>
</div>

<p>
上述配置中保存邮箱的 <b>明文密码</b> ，安全性相对较低<a href="#coderef-password"class="coderef" onmouseover="CodeHighlightOn(this, 'coderef-password');" onmouseout="CodeHighlightOff(this, 'coderef-password');">15</a>，如果需要较高的安全性，可以使用smtp-gnome，将邮箱帐号密码保存到gnome-key-ring中。同时要删除或者注释掉password一行<a href="#coderef-password"class="coderef" onmouseover="CodeHighlightOn(this, 'coderef-password');" onmouseout="CodeHighlightOff(this, 'coderef-password');">15</a>。
</p>
<div class="org-src-container">

<pre class="src src-org">cd  /usr/share/doc/msmtp-gnome/scripts/
python ./msmtp-gnome-tool.py --username=YOUREMAIL@gmail.com --server=smtp.gmail.com
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-sec-1-5-3" class="outline-4">
<h4 id="sec-1-5-3"><span class="section-number-4">1.5.3</span> Imap服务器程序</h4>
<div class="outline-text-4" id="text-1-5-3">
</div><div id="outline-container-sec-1-5-3-1" class="outline-5">
<h5 id="sec-1-5-3-1"><span class="section-number-5">1.5.3.1</span> dovecot</h5>
<div class="outline-text-5" id="text-1-5-3-1">
<p>
dovecot的配置文件： /etc/dovecot/dovecot.conf
</p>
<div class="org-src-container">

<pre class="src src-org">protocols = imap

<span style="color: #8B8989; font-style: italic;"># It's nice to have separate log files for Dovecot. You could do this</span>
<span style="color: #8B8989; font-style: italic;"># by changing syslog configuration also, but this is easier.</span>
log_path = /home/feng/.config/eh-gnus/configs/log/dovecot.log
info_log_path = /home/feng/.config/eh-gnus/configs/log/dovecot-info.log

<span style="color: #8B8989; font-style: italic;"># Disable SSL for now.</span>
ssl = no
disable_plaintext_auth = no

<span style="color: #8B8989; font-style: italic;"># We're using Maildir format</span>
mail_location = maildir:/home/feng/maildir/%u

<span style="color: #8B8989; font-style: italic;"># Authentication configuration:</span>
auth_verbose = yes
auth_mechanisms = plain

passdb {
  driver = password-file
  args = /home/feng/.config/eh-gnus/configs/password-file
}
userdb {
  driver = static
  args = uid=feng gid=feng home=/home/feng/maildir/.home/%u
}
</pre>
</div>

<p>
与dovecot配置文件对应的password文件： /etc/devecot/password
</p>

<div class="org-src-container">

<pre class="src src-org">myemail:{plain}myemail-password:feng:feng::/home/feng/maildir/.home/myemail::userdb_mail=maildir:/home/feng/maildir/myemail
myrss:{plain}myrss-password:feng:feng::/home/feng/maildir/.home/myrss::userdb_mail=maildir:/home/feng/maildir/myrss
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-sec-1-5-4" class="outline-4">
<h4 id="sec-1-5-4"><span class="section-number-4">1.5.4</span> 邮件下载程序</h4>
<div class="outline-text-4" id="text-1-5-4">
</div><div id="outline-container-sec-1-5-4-1" class="outline-5">
<h5 id="sec-1-5-4-1"><span class="section-number-5">1.5.4.1</span> offlineimap</h5>
<div class="outline-text-5" id="text-1-5-4-1">
<p>
offlineimap配置文件:  ~/.offlineimaprc
</p>
<div class="org-src-container">

<pre class="src src-org">[general]
accounts = email-account-1
pythonfile = /home/feng/.config/eh-gnus/configs/offlineimap.py
ui = quiet

[Account email-account-1]
localrepository = local-imap-1
remoterepository = remote-imap-1
<span style="color: #8B8989; font-style: italic;"># autorefresh = 3</span>

[Repository local-imap-1]
type = IMAP
remotehost = localhost
remoteuser = myemail
remotepasseval = get_password("local-imap-1")
holdconnectionopen = yes

[Repository remote-imap-1]
type = IMAP
remotehost = imap.gmail.com
remoteuser = YOUREMAIL@gmail.com
remotepasseval = get_password("remote-imap-1")
ssl = yes
cert_fingerprint=f3043dd689a2e7dddfbef82703a6c65ea9b634c1
maxconnections = 3
realdelete = no
<span style="color: #8B8989; font-style: italic;"># holdconnectionopen = true</span>
<span style="color: #8B8989; font-style: italic;"># keepalive = 60</span>

<span style="color: #8B8989; font-style: italic;"># nametrans = lambda folder: re.sub('.*Spam$', 'Spam',</span>
<span style="color: #8B8989; font-style: italic;">#       re.sub('.*Drafts$', 'Drafts',</span>
<span style="color: #8B8989; font-style: italic;">#       re.sub('.*Sent Mail$', 'Sent',</span>
<span style="color: #8B8989; font-style: italic;">#       re.sub('.*Starred$', 'Flagged',</span>
<span style="color: #8B8989; font-style: italic;">#       re.sub('.*Trash$', 'Trash',</span>
<span style="color: #8B8989; font-style: italic;">#       re.sub('.*All Mail$', 'Archive', folder))))))</span>
folderfilter = lambda foldername: not re.search('(Trash|Del|Archive|All Mail|Spam|Chats)', foldername)
</pre>
</div>

<p>
offlineimap.py文件
</p>
<div class="org-src-container">

<pre class="src src-org">#!/usr/bin/python
import re, os

def get_password(repository):
    s = "#[ ]+offlineimap[ ]+%s[ ]+([^ \n]*)" % (repository)
    p = re.compile(s)
    ### you should setup gpg-agent proper ###
    authinfo = os.popen("gpg -q --no-tty -d ~/.authinfo.gpg").read()
    return p.search(authinfo).group(1)
</pre>
</div>

<p>
~/.authinfo.gpg文件:
</p>
<div class="org-src-container">

<pre class="src src-org">### offlineimap remote-imap-1 YOURPASSWORD
### offlineimap local-imap-1 myemail-password
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-1-5-4-2" class="outline-5">
<h5 id="sec-1-5-4-2"><span class="section-number-5">1.5.4.2</span> isync</h5>
<div class="outline-text-5" id="text-1-5-4-2">
<p>
isync配置文件： ~/.mbsyncrc
</p>
<div class="org-src-container">

<pre class="src src-org">IMAPAccount remote-email-account
Host imap.gmail.com
User YOUREMAIL@gmail.com
Pass YOURPASSWORD
UseIMAPS yes
<span style="color: #8B8989; font-style: italic;"># RequireSSL yes</span>
<span style="color: #8B8989; font-style: italic;"># You should install package: ca-certificates.</span>
CertificateFile /etc/ssl/certs/ca-certificates.crt

IMAPStore remote-email-store
Account remote-email-account

IMAPAccount local-dovecot-account
Host localhost
User myemail
Pass myemail-password

IMAPStore local-dovecot-store
Account local-dovecot-account

Channel get-default-email
Master :remote-email-store:
Slave :local-dovecot-store:
<span style="color: #8B8989; font-style: italic;"># Exclude everything under the internal [Gmail] folder, except the interesting folders</span>
Patterns * ![Gmail]* "[Gmail]/Sent Mail" "[Gmail]/Starred"
<span style="color: #8B8989; font-style: italic;"># Or include everything</span>
#Patterns *
<span style="color: #8B8989; font-style: italic;"># Automatically create missing mailboxes, both locally and on the server</span>
Create Both
<span style="color: #8B8989; font-style: italic;"># Save the synchronization state files in the relevant directory</span>
SyncState /home/feng/.config/eh-gnus/configs/mbsyncstate/get-default-email

Channel get-all-email
Master :remote-email-store:
Slave :local-dovecot-store:
Patterns "[Gmail]/All Mail"
Create Slave
Sync New
SyncState /home/feng/.config/eh-gnus/configs/mbsyncstate/get-all-email

Channel get-spam-email
Master :gmail-store:
Slave :local-dovecot-store:
Patterns "[Gmail]/Spam"
Create Master
Sync Push
SyncState /home/feng/.config/eh-gnus/configs/mbsyncstate/get-spam-email
</pre>
</div>
</div>
</div>
<div id="outline-container-sec-1-5-4-3" class="outline-5">
<h5 id="sec-1-5-4-3"><span class="section-number-5">1.5.4.3</span> fdm</h5>
</div>
</div>
<div id="outline-container-sec-1-5-5" class="outline-4">
<h4 id="sec-1-5-5"><span class="section-number-4">1.5.5</span> 新闻组下载程序</h4>
<div class="outline-text-4" id="text-1-5-5">
</div><div id="outline-container-sec-1-5-5-1" class="outline-5">
<h5 id="sec-1-5-5-1"><span class="section-number-5">1.5.5.1</span> leafnode</h5>
<div class="outline-text-5" id="text-1-5-5-1">
<p>
leafnode运行必须有完整的域名， 如果只将leafnode作为一个news下载器，我们可以设定一个伪造的域名，比如：在debian系统中，我们可以更改/etc/hosts文件：
</p>

<div class="org-src-container">

<pre class="src src-org">127.0.0.1     news.tumashu-localhost.org localhost
127.0.1.1     news.tumashu-localhost.org tumashu

<span style="color: #8B8989; font-style: italic;"># The following lines are desirable for IPv6 capable hosts</span>
::1     localhost ip6-localhost ip6-loopback
ff02::1 ip6-allnodes
ff02::2 ip6-allrouters
</pre>
</div>
<p>
注意： 设定域名这个步骤非常关键， 建议重新启动系统，另外系统时间也要设定正确。
</p>

<p>
leafnode配置
</p>
<div class="org-src-container">

<pre class="src src-org">sudo dpkg-reconfigure leafnode
</pre>
</div>
<p>
配置选项选择：
</p>
<ol class="org-ol">
<li>Server to download news from:  (我使用 news.gmane.org)
</li>
<li>Network connection type:   (permanent，一小时下载一次)
</li>
<li>Enable access controls for Leafnode?  (yes)
</li>
<li>Update the list of available groups? (第一次使用建议选yes)
</li>
</ol>

<p>
配置完成后，建议手动下载news:
</p>
<div class="org-src-container">

<pre class="src src-org">sudo /etc/news/leafnode/do-fetch-news
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-sec-1-5-6" class="outline-4">
<h4 id="sec-1-5-6"><span class="section-number-4">1.5.6</span> rss下载程序</h4>
<div class="outline-text-4" id="text-1-5-6">
</div><div id="outline-container-sec-1-5-6-1" class="outline-5">
<h5 id="sec-1-5-6-1"><span class="section-number-5">1.5.6.1</span> rss2email</h5>
<div class="outline-text-5" id="text-1-5-6-1">
<p>
rss2email配置文件: ~/.configs/rss2email.conf
</p>
<div class="org-src-container">

<pre class="src src-org">[DEFAULT]
from = user@rss2email.invalid
use-8bit = False
force-from = False
use-publisher-email = False
name-format = {feed-title}: {author}
to = feng@localhost
proxy =
feed-timeout = 120
active = True
digest = False
date-header = False
date-header-order = modified, issued, created, expired
bonus-header =
trust-guid = True
trust-link = False
encodings = US-ASCII, ISO-8859-1, UTF-8, BIG5, ISO-2022-JP
post-process = rss2email_post_hooks.pinyin_header add_pinyin_header
digest-post-process =
html-mail = True
use-css = True
css = h1 {
	font: 18pt Georgia, "Times New Roman";
	}
	body {
	font: 12pt Arial;
	}
	a:link {
	font: 12pt Arial;
	font-weight: bold;
	color: #0000cc;
	}
	blockquote {
	font-family: monospace;
	}
	.header {
	background: #e0ecff;
	border-bottom: solid 4px #c3d9ff;
	padding: 5px;
	margin-top: 0px;
	color: red;
	}
	.header a {
	font-size: 20px;
	text-decoration: none;
	}
	.footer {
	background: #c3d9ff;
	border-top: solid 4px #c3d9ff;
	padding: 5px;
	margin-bottom: 0px;
	}
	border: solid 4px #c3d9ff;
	}
	margin-left: 5px;
	margin-right: 5px;
	}
unicode-snob = False
links-after-each-paragraph = False
body-width = 0
email-protocol = imap
sendmail = /usr/sbin/sendmail
smtp-auth = False
smtp-username = username
smtp-password = password
smtp-server = smtp.yourisp.net:25
smtp-ssl = False
smtp-ssl-protocol = SSLv3
imap-auth = True
imap-username = myrss
imap-password = myrss-password
imap-server = localhost
imap-port = 143
imap-ssl = False
imap-mailbox = INBOX
verbose = warning

[feed.org-mode.git]
url = <span style="color: #96CBFE; text-decoration: underline;"><a href="http://repo.or.cz/w/org-mode.git/rss">http://repo.or.cz/w/org-mode.git/rss</a></span>

[feed.emacs.git]
url = <span style="color: #96CBFE; text-decoration: underline;"><a href="http://repo.or.cz/w/emacs.git/rss">http://repo.or.cz/w/emacs.git/rss</a></span>

[feed.baidu.internet.news]
url = <span style="color: #96CBFE; text-decoration: underline;"><a href="http://news.baidu.com/n?cmd=1&amp;class=internet&amp;tn=rss">http://news.baidu.com/n?cmd=1&amp;class=internet&amp;tn=rss</a></span>
</pre>
</div>

<p>
直接使用r2e命令添加rss地址太罗嗦，写一个shell脚本来处理：
</p>
<ol class="org-ol">
<li>保存下面代码到一个目录, 比如： ~/bin/add-rss-with-rss2email.sh
</li>
<li>安装firefox扩展： AppLauncher
</li>
<li>配置AppLauncher
<ol class="org-ol">
<li>name:  rss2email
</li>
<li>path:  /usr/bin/x-terminal-emulator
</li>
<li>arguments: &#x2013;command=~/bin/add-rss-with-rss2email.sh &amp;url
</li>
</ol>
</li>
</ol>

<div class="org-src-container">

<pre class="src src-org">#!/bin/bash

PYTHONPATH=$PYTHONPATH:/home/feng/.config/eh-gnus/configs
echo "The Feed url is: $1"
echo "Please enter a name for this feed"
read feed_name
echo "run command: r2e add $feed_name $1"
r2e add $feed_name $1
r2e list
echo "Wait 10 second or press C-c to quit."
read -t 10
</pre>
</div>
</div>
</div>
</div>
</div>

<div id="outline-container-sec-1-6" class="outline-3">
<h3 id="sec-1-6"><span class="section-number-3">1.6</span> 定时下载rss和同步邮件</h3>
<div class="outline-text-3" id="text-1-6">
<p>
定时运行程序最常用的方法是设置cron程序。但由于环境变量问题，rss2email和offlineimap在cron环境下经常莫名奇妙的不工作，而且很难调试。
</p>

<p>
我这里使用两个简单的elisp程序来实现定时同步邮件和定时下载rss，设置简单，调试方便。
另外也可以使用offlineimap专用emacs包：offlineimap。
</p>

<p>
eh-offlineimap.el文件:
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(setq eh-offlineimap-buffer-name <span style="color: #61CE3C;">"*eh-offlineimap*"</span>)
(setq eh-offlineimap-command <span style="color: #61CE3C;">"offlineimap -u MachineUI"</span>)
(<span style="color: #FBDE2D;">defvar</span> <span style="color: #D8FA3C;">eh-offlineimap-timer</span> nil)

<span style="color: #8B8989; font-style: italic;">;;;</span><span style="color: #8B8989; font-style: italic;">###</span><span style="color: #ff69b4; font-style: italic;">autoload</span>
(<span style="color: #FBDE2D;">defun</span> <span style="color: #ff1493;">eh-offlineimap</span> ()
  <span style="color: #61CE3C;">"Start Offlineimap."</span>
  (interactive)
  (<span style="color: #FBDE2D;">let*</span> ((buffer (get-buffer-create eh-offlineimap-buffer-name)))
    (<span style="color: #FBDE2D;">if</span> (get-buffer-process buffer)
	(message <span style="color: #61CE3C;">"offlineimap is running"</span>)
      (<span style="color: #FBDE2D;">progn</span>
	(<span style="color: #FBDE2D;">with-current-buffer</span> buffer
	  (<span style="color: #FBDE2D;">let</span> ((inhibit-read-only t))
	    (remove-overlays)
	    (erase-buffer)
	    (insert <span style="color: #61CE3C;">"###### offlineimap verbose log #####\n"</span>)))
	(<span style="color: #FBDE2D;">let</span> ((process (start-process-shell-command
			<span style="color: #61CE3C;">"offlineimap"</span>
			buffer
			eh-offlineimap-command))))))))

(<span style="color: #FBDE2D;">defun</span> <span style="color: #ff1493;">eh-offlineimap-cron</span> ()
  (interactive)
  (<span style="color: #FBDE2D;">when</span> eh-offlineimap-timer
    (cancel-timer eh-offlineimap-timer))
  (setq eh-offlineimap-timer
	(run-with-timer
	 nil (* 5 60)
	 '(<span style="color: #FBDE2D;">lambda</span> ()
	    (message <span style="color: #61CE3C;">"Sync email with eh-offlineimap ..."</span>)
	    (eh-offlineimap)))))
</pre>
</div>

<p>
eh-rss2email.el文件:
</p>
<div class="org-src-container">

<pre class="src src-emacs-lisp">(setq eh-rss2email-buffer-name <span style="color: #61CE3C;">"*eh-rss2email*"</span>)
(setq eh-rss2email-command <span style="color: #61CE3C;">"PYTHONPATH=/home/feng/.config/eh-gnus/configs; r2e -V run"</span>)
(<span style="color: #FBDE2D;">defvar</span> <span style="color: #D8FA3C;">eh-rss2email-timer</span> nil)

<span style="color: #8B8989; font-style: italic;">;;;</span><span style="color: #8B8989; font-style: italic;">###</span><span style="color: #ff69b4; font-style: italic;">autoload</span>
(<span style="color: #FBDE2D;">defun</span> <span style="color: #ff1493;">eh-rss2email</span> ()
  <span style="color: #61CE3C;">"Start Rss2email."</span>
  (interactive)
  (<span style="color: #FBDE2D;">let*</span> ((buffer (get-buffer-create eh-rss2email-buffer-name)))
    (<span style="color: #FBDE2D;">if</span> (get-buffer-process buffer)
	(message <span style="color: #61CE3C;">"rss2email is running"</span>)
      (<span style="color: #FBDE2D;">progn</span>
	(<span style="color: #FBDE2D;">with-current-buffer</span> buffer
	  (<span style="color: #FBDE2D;">let</span> ((inhibit-read-only t))
	    (remove-overlays)
	    (erase-buffer)
	    (insert <span style="color: #61CE3C;">"###### rss2email verbose log #####\n"</span>)))
	(<span style="color: #FBDE2D;">let</span> ((process (start-process-shell-command
			<span style="color: #61CE3C;">"rss2email"</span>
			buffer
			eh-rss2email-command))))))))

(<span style="color: #FBDE2D;">defun</span> <span style="color: #ff1493;">eh-rss2email-cron</span> ()
  (interactive)
  (<span style="color: #FBDE2D;">when</span> eh-rss2email-timer
    (cancel-timer eh-rss2email-timer))
  (setq eh-rss2email-timer
	(run-with-timer
	 nil (* 120 60)
	 '(<span style="color: #FBDE2D;">lambda</span> ()
	    (message <span style="color: #61CE3C;">"Download rss with eh-rss2email ..."</span>)
	    (eh-rss2email)))))
</pre>
</div>

<p>
将下述几行代码添加到emacs配置文件中，gnus启动之前就会运行eh-offlineimap-cron和eh-rss2email-cron两个函数，让其定时同步邮件和下载程序。
</p>
<div class="org-src-container">

<pre class="src src-emacs-lisp">(add-hook 'gnus-before-startup-hook
	  '(<span style="color: #FBDE2D;">lambda</span> ()
	     (load <span style="color: #61CE3C;">"/home/feng/.config/eh-gnus/configs/eh-offlineimap.el"</span>)
	     (load <span style="color: #61CE3C;">"/home/feng/.config/eh-gnus/configs/eh-rss2email.el"</span>)
	     (eh-offlineimap-cron)
	     (eh-rss2email-cron)))
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-1-7" class="outline-3">
<h3 id="sec-1-7"><span class="section-number-3">1.7</span> gnus配置</h3>
<div class="outline-text-3" id="text-1-7">
<p>
调整eh-gnus.el文件中如下几行：
</p>
<div class="org-src-container">

<pre class="src src-emacs-lisp">(setq gnus-select-method
      '(nnimap <span style="color: #61CE3C;">"myemail"</span>
	       (nnimap-address <span style="color: #61CE3C;">"localhost"</span>)
	       (nnimap-stream network)))

(add-to-list 'gnus-secondary-select-methods
	     '(nnimap <span style="color: #61CE3C;">"myrss"</span>
		      (nnimap-address <span style="color: #61CE3C;">"localhost"</span>)
		      (nnimap-stream network)))

(add-to-list 'gnus-secondary-select-methods
	     '(nntp <span style="color: #61CE3C;">"localhost"</span>))
</pre>
</div>

<p>
然后运行gnus。
</p>
</div>
</div>
</div>
<div id="outline-container-sec-2" class="outline-2">
<h2 id="sec-2"><span class="section-number-2">2</span> eh-translate.el</h2>
<div class="outline-text-2" id="text-2">
</div><div id="outline-container-sec-2-1" class="outline-3">
<h3 id="sec-2-1"><span class="section-number-3">2.1</span> 截图显摆</h3>
<div class="outline-text-3" id="text-2-1">
</div><div id="outline-container-sec-2-1-1" class="outline-4">
<h4 id="sec-2-1-1"><span class="section-number-4">2.1.1</span> sdcv字典</h4>
<div class="outline-text-4" id="text-2-1-1">

<div class="figure">
<p><img src="./images/eh-sdcv.png" alt="eh-sdcv.png" />
</p>
</div>
</div>
</div>
<div id="outline-container-sec-2-1-2" class="outline-4">
<h4 id="sec-2-1-2"><span class="section-number-4">2.1.2</span> google翻译</h4>
<div class="outline-text-4" id="text-2-1-2">

<div class="figure">
<p><img src="./images/eh-google-translate.png" alt="eh-google-translate.png" />
</p>
</div>
</div>
</div>
<div id="outline-container-sec-2-1-3" class="outline-4">
<h4 id="sec-2-1-3"><span class="section-number-4">2.1.3</span> bing翻译</h4>
<div class="outline-text-4" id="text-2-1-3">

<div class="figure">
<p><img src="./images/eh-bing-translate.png" alt="eh-bing-translate.png" />
</p>
</div>
</div>
</div>
</div>

<div id="outline-container-sec-2-2" class="outline-3">
<h3 id="sec-2-2"><span class="section-number-3">2.2</span> 命令介绍</h3>
<div class="outline-text-3" id="text-2-2">
</div><div id="outline-container-sec-2-2-1" class="outline-4">
<h4 id="sec-2-2-1"><span class="section-number-4">2.2.1</span> eh-bing-translate-at-point</h4>
<div class="outline-text-4" id="text-2-2-1">
<ol class="org-ol">
<li>翻译光标处的单词，不可以翻译句子。
</li>
<li>使用eww调用bing网页，在线翻译。
</li>
</ol>
</div>
</div>
<div id="outline-container-sec-2-2-2" class="outline-4">
<h4 id="sec-2-2-2"><span class="section-number-4">2.2.2</span> eh-sdcv-translate-at-point</h4>
<div class="outline-text-4" id="text-2-2-2">
<ol class="org-ol">
<li>可以翻译单词，不可以翻译句子。
</li>
<li>可以英译汉，也可以汉译英（需要stardict词库支持）。
</li>
<li>使用org-mode显示sdcv翻译输出的结果。
</li>
</ol>
</div>
</div>
<div id="outline-container-sec-2-2-3" class="outline-4">
<h4 id="sec-2-2-3"><span class="section-number-4">2.2.3</span> google-translate-at-point</h4>
<div class="outline-text-4" id="text-2-2-3">
<ol class="org-ol">
<li>使用google在线翻译。
</li>
<li>可以翻译单词和句子。
</li>
</ol>
</div>
</div>
</div>
</div>
<div id="outline-container-sec-3" class="outline-2">
<h2 id="sec-3"><span class="section-number-2">3</span> eh-fonts.el</h2>
<div class="outline-text-2" id="text-3">
</div><div id="outline-container-sec-3-1" class="outline-3">
<h3 id="sec-3-1"><span class="section-number-3">3.1</span> 安装</h3>
<div class="outline-text-3" id="text-3-1">
<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span style="color: #FBDE2D;">require</span> '<span style="color: #4c83ff;">eh-fonts</span>)
</pre>
</div>
</div>
</div>
<div id="outline-container-sec-3-2" class="outline-3">
<h3 id="sec-3-2"><span class="section-number-3">3.2</span> 设置</h3>
<div class="outline-text-3" id="text-3-2">
<div class="org-src-container">

<pre class="src src-emacs-lisp">(eh-fonts-setup)
</pre>
</div>


<div class="figure">
<p><img src="./images/eh-fonts-setup.png" alt="eh-fonts-setup.png" />
</p>
</div>

<p>
eh-custom-fonts-names-alist第一个列表为英文等宽字体列表，第二个列表为中文字体列表。调整（添加字体名称，删除字体名称或者排序字体名称）后， 按C-c C-c查看字体显示效果（只能查看字体显示是否正确，不能查看字体是否对齐）。
</p>


<div class="figure">
<p><img src="./images/eh-fonts-setup-fontnames.png" alt="eh-fonts-setup-fontnames.png" />
</p>
</div>

<p>
中文和英文字体设定无误后，继续调整eh-custom-fonts-scales-list，以实现中英文对齐。将光标移动到每一个数字上，按C-c C-c，根据对齐结果调整数字大小，直到中文和英文可以完美对齐。
</p>


<div class="figure">
<p><img src="./images/eh-fonts-setup-scales1.png" alt="eh-fonts-setup-scales1.png" />
</p>
</div>

<p>
9个数字一一调整， 调整完成后保存文件。
</p>


<div class="figure">
<p><img src="./images/eh-fonts-setup-scales1.png" alt="eh-fonts-setup-scales1.png" />
</p>
</div>
</div>
</div>

<div id="outline-container-sec-3-3" class="outline-3">
<h3 id="sec-3-3"><span class="section-number-3">3.3</span> 使用</h3>
<div class="outline-text-3" id="text-3-3">
<p>
放大字体
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">eh-font-size-increase
</pre>
</div>

<p>
缩小字体
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">eh-font-size-decrease
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-sec-4" class="outline-2">
<h2 id="sec-4"><span class="section-number-2">4</span> eh-complete.el</h2>
<div class="outline-text-2" id="text-4">
<p>
company默认使用overlay菜单frontend， 中文显示存在问题。我简单的写了一个sidebar frontend, 效果如下：
</p>


<div class="figure">
<p><img src="./images/eh-company-sidebar-effect1.png" alt="eh-company-sidebar-effect1.png" />
</p>
</div>


<div class="figure">
<p><img src="./images/eh-company-sidebar-effect2.png" alt="eh-company-sidebar-effect2.png" />
</p>
</div>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="author">&#20316;&#32773;: 冯书</p>
<p class="date">Created: 2014-12-01 一 13:56</p>
<p class="creator"><a href="http://www.gnu.org/software/emacs/">Emacs</a> 25.0.50.1 (<a href="http://orgmode.org">Org</a> mode 8.3beta)</p>
<p class="validation"><a href="http://validator.w3.org/check?uri=referer">Validate</a></p>
</div>
</body>
</html>
